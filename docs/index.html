<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kinobox Player</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
        }
        .kinobox_player {
            width: 100%;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div class="kinobox_player"></div>
    <script src="https://kinobox.tv/kinobox.min.js"></script>
    <script>
        // Получаем параметры из URL
        const urlParams = new URLSearchParams(window.location.search);
        const kinopoiskId = urlParams.get('kp');
        const title = urlParams.get('title');

        // Настраиваем плеер
        const options = {
            search: {},
            menu: {
                enable: true,
                default: 'menu_list',
                mobile: 'menu_button',
                format: '{N} :: {T} ({Q})',
                limit: null,
                open: true
            },
            players: {
                alloha: { 
                    enable: true, 
                    position: 1
                },
                cdnmovies: { 
                    enable: true, 
                    position: 2
                },
                kodik: { 
                    enable: true, 
                    position: 3
                },
                videocdn: { 
                    enable: true, 
                    position: 4
                }
            },
            params: {
                all: {
                    autoplay: 1
                },
                alloha: {
                    autoplay: 1,
                    translations_hidden: false
                },
                cdnmovies: {
                    autoplay: 1
                },
                kodik: {
                    hide_selectors: false,
                    auto_translation: true
                },
                videocdn: {
                    autoplay: 1,
                    select: 1
                }
            },
            events: {
                playerLoaded: function(status, sources) {
                    console.log('Player loaded:', status, sources);
                    if (status && sources && sources.length > 0) {
                        console.log('Available sources:', sources.length);
                    }
                }
            }
        };

        // Приоритет поиска: сначала по ID Кинопоиска, потом по названию
        if (kinopoiskId) {
            options.search.kinopoisk = kinopoiskId;
        } else if (title) {
            options.search.title = title;
        }

        // Инициализируем плеер
        kbox('.kinobox_player', options);

        // Добавляем слушатель событий для отслеживания загрузки плеера
        document.addEventListener('KinoboxPlayerLoaded', (event) => {
            console.log('Player loaded event:', event.detail);
        });
    </script>
</body>
</html>
